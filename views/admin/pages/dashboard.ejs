<div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
  <div id="kt_app_toolbar_container" class="app-container container-fluid d-flex flex-stack">
    <div class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
      <h1 class="page-heading d-flex text-gray-900 fw-bold fs-3 flex-column justify-content-center my-0">Dashboard</h1>
      <ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
        <li>
          <a href="/" class="text-muted text-hover-primary">Home</a>
        </li>
        <li class="breadcrumb-item">
          <span class="bullet bg-gray-500 w-5px h-2px"></span>
        </li>
        <li class="breadcrumb-item text-muted">Dashboard</li>
      </ul>
    </div>

  </div>
</div>
</div>
<div id="kt_app_content" class="app-content flex-column-fluid">
  <div id="kt_app_content_container" class="app-container container-fluid">
    <div class="row gx-5 gx-xl-10 mb-xl-10">
      <div class="col-md-6 col-lg-6 col-xl-6 col-xxl-3 mb-10">
        <div class="card card-flush bgi-no-repeat bgi-size-contain bgi-position-x-center border-0 h-md-50 mb-5 mb-xl-10" style="background-color: #080655">
          <div class="card-header pt-5">
            <div class="card-title d-flex flex-column">
              <span class="fs-2hx fw-bold text-white me-2 lh-1 ls-n2"><%= dashboard_data.total_customers %></span>
              <span class="text-white opacity-50 pt-1 fw-semibold fs-6">Total Customers</span>
            </div>
          </div>
          <div class="card-body d-flex align-items-end pt-0">
            <div class="d-flex align-items-center flex-column mt-3 w-100">
              <div class="d-flex justify-content-between fw-bold fs-6 text-white opacity-50 w-100 mt-auto mb-2">
                <%
                const totalCustomers = dashboard_data.total_customers;
                const subscribedCustomers = dashboard_data.total_subscribers;
                let subscriptionPercentage = (subscribedCustomers / totalCustomers) * 100;
                subscriptionPercentage=subscriptionPercentage.toFixed(2);

                %>
                <span><%= dashboard_data.total_subscribers %> Subscribers</span>
                <span><%= subscriptionPercentage %> %</span>
              </div>
              <div class="h-8px mx-3 w-100 bg-light-danger rounded">
                <div class="bg-danger rounded h-8px" role="progressbar" style="width: <%= subscriptionPercentage %>%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="card card-flush h-md-50 mb-5 mb-xl-10">
          <div class="card-header pt-5">
            <div class="card-title d-flex flex-column">
              <span class="fs-2hx fw-bold text-gray-900 me-2 lh-1 ls-n2"><%= dashboard_data.total_subscribers %></span>
              <span class="text-gray-500 pt-1 fw-semibold fs-6">Subscribers</span>
            </div>
          </div>
          <div class="card-body d-flex flex-column justify-content-end pe-0">
            <span class="fs-6 fw-bolder text-gray-800 d-block mb-2">Recent Subscribers</span>


            <div class="symbol-group symbol-hover flex-nowrap">
              <%
                    const colors = ['bg-primary', 'bg-success', 'bg-danger', 'bg-warning', 'bg-info'];
                    %>

              <% dashboard_data.subscribers_names.forEach((subscriber, index) => { %>
              <%
                        const fullName = subscriber.cust_name; // Extract name
                        const nameParts = fullName.split(' ');
                        const initials = nameParts.map(name => name[0]).join('').toUpperCase(); // Get initials (e.g., "SJ" for Sagar Jagde)
                        const colorClass = colors[index % colors.length]; // Rotate colors
                    %>

              <div class="symbol symbol-35px symbol-circle" data-bs-toggle="tooltip" title="<%= fullName %>">
                <span class="symbol-label <%= colorClass %> text-white fw-bold">
                  <%= initials %>
                </span>
              </div>
              <% }); %>

              <a href="#" class="symbol symbol-35px symbol-circle" data-bs-toggle="modal" data-bs-target="#kt_modal_view_users">
                <span class="symbol-label bg-dark text-gray-300 fs-8 fw-bold">+<%= (dashboard_data.total_subscribers-dashboard_data.subscribers_names.length)  %></span>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-lg-6 col-xl-6 col-xxl-3 mb-10">
        <div class="card card-flush h-md-50 mb-5 mb-xl-10">
          <div class="card-header pt-5">
            <div class="card-title d-flex flex-column">
              <div class="d-flex align-items-center">
                <span class="fs-4 fw-semibold text-gray-500 me-1 align-self-start">₹</span>
                <span class="fs-2hx fw-bold text-gray-900 me-2 lh-1 ls-n2"><%= dashboard_data.total_amount %></span>

              </div>
              <span class="text-gray-500 pt-1 fw-semibold fs-6">Total Earnings in Till Today</span>
            </div>
          </div>
          <div class="card-body pt-2 pb-4 d-flex flex-wrap align-items-center">
            <div class="d-flex flex-center me-5 pt-2">
              <div id="year_earning" style="min-width: 70px; min-height: 70px" data-kt-size="70" data-kt-line="11"></div>
            </div>
            <div class="d-flex flex-column content-justify-center flex-row-fluid">
              <div class="d-flex fw-semibold align-items-center">
                <div class="bullet w-8px h-3px rounded-2 bg-success me-3"></div>
                <div class="text-gray-500 flex-grow-1 me-4"><%= dashboard_data.tot_yearwise_amount_res[0].year %></div>
                <div class="fw-bolder text-gray-700 text-xxl-end">₹ <%= dashboard_data.tot_yearwise_amount_res[0].total_amount %></div>
                <input type="hidden" id="year1" year="<%= dashboard_data.tot_yearwise_amount_res[0].year %>" amount="<%= dashboard_data.tot_yearwise_amount_res[0].total_amount %>">
              </div>
              <div class="d-flex fw-semibold align-items-center my-3">
                <div class="bullet w-8px h-3px rounded-2 bg-primary me-3"></div>
                <div class="text-gray-500 flex-grow-1 me-4"><%= dashboard_data.tot_yearwise_amount_res[1].year %></div>
                <div class="fw-bolder text-gray-700 text-xxl-end">₹ <%= dashboard_data.tot_yearwise_amount_res[1].total_amount %></div>
                <input type="hidden" id="year2" year="<%= dashboard_data.tot_yearwise_amount_res[1].year %>" amount="<%= dashboard_data.tot_yearwise_amount_res[1].total_amount %>">
              </div>
              <div class="d-flex fw-semibold align-items-center">
                <div class="bullet w-8px h-3px rounded-2 me-3" style="background-color: #f8285a"></div>
                <div class="text-gray-500 flex-grow-1 me-4"><%= dashboard_data.tot_yearwise_amount_res[2].year %></div>
                <div class="fw-bolder text-gray-700 text-xxl-end">₹ <%= dashboard_data.tot_yearwise_amount_res[2].total_amount %></div>
                <input type="hidden" id="year3" year="<%= dashboard_data.tot_yearwise_amount_res[2].year %>" amount="<%= dashboard_data.tot_yearwise_amount_res[2].total_amount %>">
              </div>
            </div>
          </div>
        </div>
        <div class="card card-flush h-md-50 mb-5 mb-xl-10">
          <div class="card-header pt-5">
            <div class="card-title d-flex flex-column">
              <div class="d-flex align-items-center">
                <span class="fs-4 fw-semibold text-gray-500 me-1 align-self-start"></span>
                <span class="fs-2hx fw-bold text-gray-900 me-2 lh-1 ls-n2"><%= dashboard_data.total_courses_count %></span>

              </div>
              <span class="text-gray-500 pt-1 fw-semibold fs-6">Total Courses</span>
            </div>
          </div>
          <div class="card-body pt-2 pb-1 d-flex flex-wrap">
            <b class="">Trending Courses</b>
            <div class="d-flex flex-column content-justify-center flex-row-fluid">
            <%
            if(dashboard_data.trending_courses[0] && dashboard_data.trending_courses[0].name!='')
            {
            %>
              <div class="d-flex fw-semibold align-items-center">
                <div class="bullet w-8px h-3px rounded-2 bg-success me-3"></div>
                <div class="text-gray-500 flex-grow-1 me-4"><%= dashboard_data.trending_courses[0].name %></div>
              </div>
            <%
            }
            %>
            <%
            if(dashboard_data.trending_courses[1] && dashboard_data.trending_courses[1].name!='')
            {
            %>
              <div class="d-flex fw-semibold align-items-center my-3">
                <div class="bullet w-8px h-3px rounded-2 bg-primary me-3"></div>
                <div class="text-gray-500 flex-grow-1 me-4"><%= dashboard_data.trending_courses[1].name %></div>

              </div>
            <%
            }
            %>
            <%
            if(dashboard_data.trending_courses[2] && dashboard_data.trending_courses[2].name!='')
            {
            %>
              <div class="d-flex fw-semibold align-items-center">
                <div class="bullet w-8px h-3px rounded-2 me-3" style="background-color: #E4E6EF"></div>
                <div class="text-gray-500 flex-grow-1 me-4"><%= dashboard_data.trending_courses[2].name %></div>

              </div>
            <%
            }
            %>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-lg-6 col-xl-6 col-xxl-6">
        <div class="card card-flush h-100 d-flex flex-column">
          <div class="card-header pt-7">
            <h3 class="card-title align-items-start flex-column">
              <span class="card-label fw-bold text-gray-800">Masters Users count graph</span>
            </h3>
          </div>
          <div class="card-body pt-6 flex-grow-1 d-flex flex-column">
            <div class="table-responsive flex-grow-1">
              <table id="masterTable" class="table table-row-dashed align-middle gs-0 gy-3 my-0 datatable">
                <thead>
                  <tr class="fs-7 fw-bold text-gray-500 border-bottom-0">
                    <th class="p-0 pb-3 min-w-175px text-start">MASTER</th>
                    <th class="p-0 pb-3 min-w-100px text-end">COURSES</th>
                    <th class="p-0 pb-3 min-w-175px text-end pe-12">BUYERS</th>
                  </tr>
                </thead>
                <tbody>
                  <% dashboard_data.master_names.forEach((master) => { %>
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <div class="symbol symbol-50px me-3">
                          <img src="<%= master.photo %>" class="" alt="<%= master.master_name %>" />
                        </div>
                        <div class="d-flex justify-content-start flex-column">
                          <a href="#" class="text-gray-800 fw-bold text-hover-primary mb-1 fs-6">
                            <%= master.master_name %>
                          </a>
                          <span class="text-gray-500 fw-semibold d-block fs-7">
                            <%= master.profession %>
                          </span>
                        </div>
                      </div>
                    </td>
                    <td class="text-end pe-0">
                      <span class="text-gray-600 fw-bold fs-6"><%= master.course_count %></span>
                    </td>
                    <td class="text-end pe-12">
                      <span class="badge py-3 px-4 fs-7 badge-light-primary"><%= master.buyers_count %></span>
                    </td>
                  </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>


    </div>

    <div class="row g-5 g-xl-10 mb-5 mb-xl-10">
      <div class="col-xl-4">
        <div class="card card-flush h-md-100">
          <div class="card-header pt-5 mb-6">
            <h3 class="card-title text-gray-800 fw-bold">
              Monthwise courses purchase count
            </h3>

          </div>
          <div class="card-body py-0 px-0">
            <ul class="nav d-flex justify-content-end mb-3 mx-9">
              <li class="nav-item mb-3">
                <a class="year_btn1 nav-link btn btn-flex flex-center btn-active-danger btn-color-gray-600 btn-active-color-white rounded-2 w-45px h-35px" data-bs-toggle="tab" id="kt_charts_widget_35_tab_1" href="#current_year_line_tab"><%= new Date().getFullYear() %></a>
              </li>
              <li class="nav-item mb-3">
                <a class="year_btn2 nav-link btn btn-flex flex-center btn-active-danger btn-color-gray-600 btn-active-color-white rounded-2 w-45px h-35px" data-bs-toggle="tab" id="kt_charts_widget_35_tab_2" href="#last_year_line_tab"><%= new Date().getFullYear()-1 %></a>
              </li>
            </ul>

            <div class="tab-content mt-n6">
              <div class="tab-pane fade active show" id="current_year_line_tab">

                <div id="current_year_line_tab_graph" data-kt-chart-color="primary" class="min-h-auto h-200px ps-3 pe-6"></div>
              </div>

              <div class="tab-pane fade" id="last_year_line_tab">

                <div id="last_year_line_tab_graph" data-kt-chart-color="primary" class="min-h-auto h-200px ps-3 pe-6"></div>
              </div>
            </div>


          </div>
        </div>
      </div>
      <div class="col-xl-8">
        <div class="card h-md-100">
          <div class="card-header position-relative py-0 border-bottom-1">
            <h3 class="card-title text-gray-800 fw-bold">Category wise Courses purchase Count</h3>
            <!-- <ul class="nav nav-stretch nav-pills nav-pills-custom d-flex mt-4">

              <li class="nav-item p-0 ms-0">
                <a class="nav-link btn btn-color-gray-500 flex-center px-3" data-kt-timeline-widget-4="tab" data-bs-toggle="tab" href="#first_graph">
                  <span class="nav-text fw-semibold fs-4 mb-3">Month</span>
                  <span class="bullet-custom position-absolute z-index-2 w-100 h-1px top-100 bottom-n100 bg-primary rounded"></span>
                </a>
              </li>
              <li class="nav-item p-0 ms-0">
                <a class="nav-link btn btn-color-gray-500 flex-center px-3" data-kt-timeline-widget-4="tab" data-bs-toggle="tab" href="#kt_timeline_widget_4_tab_2022">
                  <span class="nav-text fw-semibold fs-4 mb-3">2022</span>
                  <span class="bullet-custom position-absolute z-index-2 w-100 h-1px top-100 bottom-n100 bg-primary rounded"></span>
                </a>
              </li>
            </ul> -->
          </div>
          <div class="card-body pb-0">
            <div id="chart_category"></div>
            <!-- <div class="tab-content">
              <div class="tab-pane" id="first_graph1" role="tabpanel" aria-labelledby="month-tab" data-kt-timeline-widget-4-blockui="true">
                <div class="pb-10">
                  <div id="chart_category" class="vis-timeline-custom h-350px min-w-700px" data-kt-timeline-widget-4-image-root="assets/media/"></div>
                </div>
              </div>
              <div class="tab-pane" id="kt_timeline_widget_4_tab_2022" role="tabpanel" aria-labelledby="week-tab" data-kt-timeline-widget-4-blockui="true">
                <div class="table-responsive pb-10">
                  <div id="kt_timeline_widget_4_4" class="vis-timeline-custom h-350px min-w-700px" data-kt-timeline-widget-4-image-root="assets/media/"></div>
                </div>
              </div>
            </div> -->

          </div>
        </div>
      </div>
    </div>

  </div>
</div>
<%- pageJs = `
<script src="/plugins/global/plugins.bundle.js"></script>
<script src="/plugins/custom/vis-timeline/vis-timeline.bundle.js"></script>
<script src="/js/widgets.bundle.js"></script>
<script src="/js/custom/widgets.js"></script>
<script src="/plugins/custom/datatables/datatables.bundle.js"></script>
<script src="/js/pages/dashboard.js"></script>
` %>

